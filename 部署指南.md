# 🌐 网站部署指南 - 让别人也能访问你的网站

本指南提供多种方案，让您的网站可以被其他人访问。

---

## 📋 方案对比

| 方案 | 难度 | 成本 | 适用场景 | 推荐度 |
|------|------|------|----------|--------|
| **Vercel** | ⭐ 简单 | 免费/付费 | 生产环境，Next.js 项目 | ⭐⭐⭐⭐⭐ |
| **Railway** | ⭐⭐ 中等 | 免费/付费 | 需要数据库托管 | ⭐⭐⭐⭐ |
| **内网穿透** | ⭐ 简单 | 免费/付费 | 临时测试 | ⭐⭐⭐ |
| **自建服务器** | ⭐⭐⭐⭐ 复杂 | 付费 | 完全控制 | ⭐⭐⭐ |

---

## 🚀 方案一：Vercel 部署（推荐）

**优点：**
- Next.js 官方推荐平台
- 自动 HTTPS、CDN 加速
- 免费套餐足够个人项目使用
- 自动部署（连接 GitHub）

**步骤：**

### 1. 准备代码仓库

```bash
# 初始化 Git（如果还没有）
git init
git add .
git commit -m "Initial commit"

# 创建 GitHub 仓库并推送
# 在 GitHub 上创建新仓库，然后：
git remote add origin https://github.com/你的用户名/仓库名.git
git push -u origin main
```

### 2. 准备数据库

Vercel 不提供 MySQL，需要单独配置：

**选项 A：使用 PlanetScale（推荐，免费）**
1. 访问 https://planetscale.com
2. 注册账号并创建数据库
3. 获取连接字符串

**选项 B：使用 Railway MySQL**
1. 访问 https://railway.app
2. 创建 MySQL 服务
3. 获取连接字符串

**选项 C：使用其他云数据库**
- 阿里云 RDS
- 腾讯云 MySQL
- AWS RDS

### 3. 部署到 Vercel

1. **访问 https://vercel.com**
2. **使用 GitHub 账号登录**
3. **点击 "New Project"**
4. **导入您的 GitHub 仓库**
5. **配置环境变量：**
   ```
   DATABASE_URL=mysql://用户名:密码@主机:端口/数据库名
   JWT_SECRET=你的密钥（生产环境请使用强密码）
   ```
6. **点击 "Deploy"**

### 4. 部署完成

部署成功后，Vercel 会提供一个 URL，例如：
```
https://your-project.vercel.app
```

**这个 URL 就可以分享给别人访问了！**

---

## 🚂 方案二：Railway 部署（包含数据库）

**优点：**
- 一站式服务（应用 + 数据库）
- 免费套餐可用
- 自动 HTTPS

**步骤：**

### 1. 准备代码

```bash
# 确保代码已推送到 GitHub
git add .
git commit -m "Ready for deployment"
git push
```

### 2. 部署到 Railway

1. **访问 https://railway.app**
2. **使用 GitHub 账号登录**
3. **点击 "New Project" → "Deploy from GitHub repo"**
4. **选择您的仓库**

### 3. 添加 MySQL 数据库

1. **在项目中点击 "+ New"**
2. **选择 "Database" → "MySQL"**
3. **Railway 会自动创建数据库**

### 4. 配置环境变量

在 Railway 项目设置中添加：
```
DATABASE_URL=从 MySQL 服务中复制连接字符串
JWT_SECRET=你的密钥
```

### 5. 部署

Railway 会自动检测 Next.js 项目并部署。

**完成后会提供一个 URL，例如：**
```
https://your-project.up.railway.app
```

---

## 🔗 方案三：内网穿透（临时测试）

**适用场景：** 快速测试，让别人临时访问你的本地开发环境

### 使用 ngrok（推荐）

1. **注册账号：** https://ngrok.com
2. **安装 ngrok：**
   ```bash
   # macOS
   brew install ngrok
   
   # 或下载：https://ngrok.com/download
   ```
3. **启动你的本地服务器：**
   ```bash
   npm run dev
   ```
4. **启动 ngrok：**
   ```bash
   ngrok http 3000
   ```
5. **复制 ngrok 提供的 URL：**
   ```
   Forwarding: https://xxxx-xx-xx-xx-xx.ngrok-free.app -> http://localhost:3000
   ```
6. **分享这个 URL 给别人**

**注意：** 免费版 URL 每次重启会变化，付费版可以固定域名。

### 使用 Cloudflare Tunnel（免费，更稳定）

1. **安装 cloudflared：**
   ```bash
   # macOS
   brew install cloudflared
   ```
2. **启动隧道：**
   ```bash
   cloudflared tunnel --url http://localhost:3000
   ```
3. **分享生成的 URL**

---

## 🖥️ 方案四：自建服务器部署

**适用场景：** 有服务器资源，需要完全控制

### 1. 准备服务器

- 云服务器（阿里云、腾讯云、AWS 等）
- 安装 Node.js 18+
- 安装 MySQL
- 安装 Nginx（可选，用于反向代理）

### 2. 部署步骤

```bash
# 1. 克隆代码
git clone https://github.com/你的用户名/仓库名.git
cd 仓库名

# 2. 安装依赖
npm install

# 3. 配置环境变量
nano .env
# 添加：
# DATABASE_URL=mysql://用户名:密码@localhost:3306/数据库名
# JWT_SECRET=你的密钥

# 4. 初始化数据库
npm run db:generate
npm run db:push

# 5. 构建生产版本
npm run build

# 6. 使用 PM2 运行（推荐）
npm install -g pm2
pm2 start npm --name "basketball-platform" -- start
pm2 save
pm2 startup
```

### 3. 配置 Nginx（可选）

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4. 配置域名和 SSL

- 购买域名
- 配置 DNS 解析
- 使用 Let's Encrypt 免费 SSL 证书

---

## ⚙️ 部署前检查清单

### 1. 环境变量配置

确保 `.env` 文件包含：
```env
DATABASE_URL=你的数据库连接字符串
JWT_SECRET=生产环境密钥（请使用强密码）
NODE_ENV=production
```

### 2. 数据库迁移

```bash
# 生成 Prisma 客户端
npm run db:generate

# 推送数据库模式
npm run db:push

# 或使用迁移（推荐生产环境）
npm run db:migrate
```

### 3. 构建测试

```bash
# 本地构建测试
npm run build
npm start

# 确保没有错误
```

### 4. 安全检查

- [ ] 更改默认的 `JWT_SECRET`
- [ ] 检查数据库连接是否安全
- [ ] 确保敏感信息不在代码中
- [ ] 配置 CORS（如需要）

---

## 🎯 推荐方案

**对于您的项目，我推荐：**

1. **快速上线：** Vercel + PlanetScale（免费，5 分钟部署）
2. **需要数据库托管：** Railway（一站式，包含 MySQL）
3. **临时测试：** ngrok（快速分享本地环境）

---

## 📞 常见问题

### Q: 部署后数据库连接失败？
A: 检查：
- 数据库是否允许外部连接
- 防火墙是否开放端口
- 连接字符串是否正确

### Q: 部署后页面显示错误？
A: 检查：
- 环境变量是否正确配置
- 构建日志是否有错误
- 数据库迁移是否完成

### Q: 如何更新网站？
A: 
- **Vercel/Railway：** 推送代码到 GitHub，自动部署
- **自建服务器：** `git pull` 然后重新构建

---

## 🎉 完成！

部署完成后，您就可以：
- ✅ 分享网站链接给任何人
- ✅ 在任何设备上访问
- ✅ 享受 HTTPS 安全连接
- ✅ 使用 CDN 加速

**祝部署顺利！** 🚀
