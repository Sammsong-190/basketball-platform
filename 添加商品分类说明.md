# 添加商品分类功能说明

## 📋 功能说明

商品现在分为两类：
- **平台自营**：管理员通过爬取功能添加的商品
- **自由交易**：卖家自己发布的商品

## 🚀 数据库迁移步骤

### 方法 1：使用 SQL 文件（推荐）

```bash
# 连接到 MySQL
mysql -u root -p basketball_platform

# 执行 SQL
source migrations/add_product_source_type.sql;
```

### 方法 2：使用 Prisma Push

```bash
# 重新生成 Prisma Client
npx prisma generate

# 推送 schema 到数据库
npx prisma db push
```

### 方法 3：手动 SQL

```sql
-- 添加 sourceType 字段
ALTER TABLE `Product` 
ADD COLUMN `sourceType` VARCHAR(20) NOT NULL DEFAULT 'FREE_TRADE';

-- 添加索引
ALTER TABLE `Product` 
ADD INDEX `idx_sourceType` (`sourceType`);
```

## ✅ 迁移后操作

1. **重新生成 Prisma Client**（重要！）
   ```bash
   npx prisma generate
   ```

2. **重启开发服务器**
   ```bash
   npm run dev
   ```

## 📊 现有商品处理

迁移后，所有现有商品默认标记为 `FREE_TRADE`（自由交易）。

如果需要将管理员爬取的商品标记为 `PLATFORM_MANAGED`：

```sql
-- 找到系统卖家的ID（通常是 username = 'system_seller'）
SELECT id, username FROM User WHERE username = 'system_seller';

-- 将系统卖家的商品标记为平台自营
UPDATE Product 
SET sourceType = 'PLATFORM_MANAGED' 
WHERE sellerId = '系统卖家ID';
```

## 🎨 显示效果

商品列表页面会显示：
- **平台自营**：蓝色标签（左上角）
- **自由交易**：绿色标签（左上角）
- **商品分类**：橙色标签（右上角）

## 📝 相关文件

- Schema: `prisma/schema.prisma`
- 迁移文件: `migrations/add_product_source_type.sql`
- 商品列表: `app/products/page.tsx`
- 商品创建API: `app/api/products/route.ts`
- 商品爬取API: `app/api/products/scrape/route.ts`
