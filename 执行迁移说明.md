# æ‰§è¡Œæ•°æ®åº“è¿ç§»è¯´æ˜

## ğŸš€ æ–¹æ³• 1ï¼šä½¿ç”¨ SQL æ–‡ä»¶ï¼ˆæ¨èï¼Œæœ€ç®€å•ï¼‰

### æ­¥éª¤ 1ï¼šè¿æ¥åˆ° MySQL

```bash
# ä½¿ç”¨ä½ çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
mysql -u root -p basketball_platform
```

### æ­¥éª¤ 2ï¼šæ‰§è¡Œ SQL æ–‡ä»¶

```bash
# åœ¨ MySQL ä¸­æ‰§è¡Œ
source migrations/add_post_content_type.sql;

# æˆ–è€…ç›´æ¥å¤åˆ¶ SQL å†…å®¹åˆ° MySQL å®¢æˆ·ç«¯æ‰§è¡Œ
```

### æ­¥éª¤ 3ï¼šéªŒè¯

```sql
-- æŸ¥çœ‹è¡¨ç»“æ„ï¼Œç¡®è®¤å­—æ®µå·²æ›´æ–°
DESCRIBE Post;

-- åº”è¯¥çœ‹åˆ°ï¼š
-- content: longtext
-- contentType: varchar(20) (é»˜è®¤å€¼: TEXT)
-- images: text
```

## ğŸ”§ æ–¹æ³• 2ï¼šä½¿ç”¨ Prismaï¼ˆå¦‚æœ npm å¯ç”¨ï¼‰

```bash
# 1. ç”Ÿæˆ Prisma Client
npx prisma generate

# 2. æ¨é€ schema åˆ°æ•°æ®åº“
npx prisma db push

# æˆ–åˆ›å»ºè¿ç§»æ–‡ä»¶
npx prisma migrate dev --name add_post_content_type
```

## âœ… è¿ç§»å®Œæˆå

### 1. é‡æ–°ç”Ÿæˆ Prisma Client

```bash
npx prisma generate
```

### 2. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

## ğŸ“ æµ‹è¯• APIï¼ˆä½¿ç”¨ curlï¼‰

### åˆ›å»ºçº¯æ–‡æœ¬å¸–å­ï¼ˆé»˜è®¤ï¼‰

```bash
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "æµ‹è¯•å¸–å­",
    "content": "è¿™æ˜¯çº¯æ–‡æœ¬å†…å®¹",
    "categoryId": null
  }'
```

### åˆ›å»º HTML æ ¼å¼å¸–å­

```bash
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "HTML æ ¼å¼å¸–å­",
    "content": "<h1>æ ‡é¢˜</h1><p>è¿™æ˜¯<strong>åŠ ç²—</strong>å†…å®¹</p>",
    "contentType": "HTML",
    "categoryId": null
  }'
```

### åˆ›å»º Markdown æ ¼å¼å¸–å­

```bash
curl -X POST http://localhost:3000/api/posts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "title": "Markdown æ ¼å¼å¸–å­",
    "content": "# æ ‡é¢˜\n\nè¿™æ˜¯**åŠ ç²—**å†…å®¹\n\n```js\nconsole.log(\"hello\")\n```",
    "contentType": "MARKDOWN",
    "categoryId": null
  }'
```

## ğŸ” éªŒè¯æ•°æ®

### åœ¨ MySQL ä¸­æŸ¥è¯¢

```sql
-- æŸ¥çœ‹æœ€æ–°å¸–å­
SELECT id, title, contentType, LEFT(content, 100) as content_preview 
FROM Post 
ORDER BY createdAt DESC 
LIMIT 5;

-- æŸ¥çœ‹å¤§æ–‡æœ¬å¸–å­
SELECT id, title, contentType, LENGTH(content) as content_length 
FROM Post 
WHERE LENGTH(content) > 10000;
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®**ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
   ```bash
   mysqldump -u root -p basketball_platform > backup_before_migration.sql
   ```

2. **ç°æœ‰æ•°æ®**ï¼š
   - æ‰€æœ‰ç°æœ‰å¸–å­çš„ `contentType` ä¼šè‡ªåŠ¨è®¾ç½®ä¸º `TEXT`ï¼ˆé»˜è®¤å€¼ï¼‰
   - ç°æœ‰ `content` æ•°æ®ä¼šè‡ªåŠ¨è½¬æ¢ä¸º `LONGTEXT`ï¼ˆMySQL è‡ªåŠ¨å¤„ç†ï¼‰

3. **æ€§èƒ½**ï¼š
   - `LONGTEXT` å­—æ®µè¾ƒå¤§ï¼ŒæŸ¥è¯¢æ—¶é¿å… `SELECT *`
   - å»ºè®®åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ

## ğŸ“š ç›¸å…³æ–‡ä»¶

- SQL è¿ç§»æ–‡ä»¶ï¼š`migrations/add_post_content_type.sql`
- è¯¦ç»†æ–¹æ¡ˆï¼š`å¸–å­å­˜å‚¨æ–¹æ¡ˆè¯´æ˜.md`
- è¿ç§»è¯´æ˜ï¼š`æ•°æ®åº“è¿ç§»è¯´æ˜.md`
