# 初始化商品分类说明

## 问题描述

卖家添加商品时，商品分类下拉列表为空，无法选择分类。

## 解决方案

### 方法 1：使用初始化脚本（推荐）

运行初始化脚本，自动创建默认的商品分类：

```bash
node init-categories.js
```

这个脚本会创建以下分类结构：

```
📁 篮球鞋
   └─ 高帮篮球鞋
   └─ 低帮篮球鞋
   └─ 中帮篮球鞋

📁 球衣
   └─ NBA球衣
   └─ 训练服
   └─ 复古球衣

📁 篮球
   └─ 室内篮球
   └─ 室外篮球
   └─ 比赛用球

📁 护具
   └─ 护膝
   └─ 护肘
   └─ 护踝
   └─ 护腕

📁 配件
   └─ 球包
   └─ 水壶
   └─ 毛巾
   └─ 头带

📁 其他
```

**注意：** 如果分类已存在，脚本会跳过（使用 `upsert`，不会重复创建）。

### 方法 2：手动在数据库中创建

如果脚本执行失败，可以手动在数据库中创建分类：

```sql
-- 连接到数据库
mysql -u root -p basketball_platform

-- 创建父分类
INSERT INTO Category (id, name, description, createdAt) VALUES
(UUID(), '篮球鞋', '各种品牌和款式的篮球鞋', NOW()),
(UUID(), '球衣', 'NBA球队球衣和训练服', NOW()),
(UUID(), '篮球', '各种规格的篮球', NOW()),
(UUID(), '护具', '运动护具和保护装备', NOW()),
(UUID(), '配件', '篮球相关配件', NOW()),
(UUID(), '其他', '其他篮球相关商品', NOW());

-- 获取父分类ID（假设篮球鞋的ID是 parent_id）
-- 然后创建子分类
INSERT INTO Category (id, name, description, parentId, createdAt) VALUES
(UUID(), '高帮篮球鞋', '高帮设计，提供更好的脚踝保护', 'parent_id', NOW()),
(UUID(), '低帮篮球鞋', '低帮设计，更灵活轻便', 'parent_id', NOW());
-- ... 其他子分类
```

### 方法 3：使用 Prisma Studio（图形界面）

```bash
npx prisma studio
```

在浏览器中打开 `http://localhost:5555`，然后：
1. 点击 `Category` 表
2. 点击 "Add record" 按钮
3. 填写分类信息（name 必填，description 可选）
4. 如果是子分类，选择 parentId
5. 保存

## 验证分类是否创建成功

### 方法 1：检查 API

```bash
curl http://localhost:3000/api/categories
```

应该返回分类列表的 JSON 数据。

### 方法 2：在浏览器中查看

访问添加商品页面：`http://localhost:3000/products/new`

分类下拉列表应该显示所有可用的分类。

### 方法 3：检查数据库

```sql
SELECT id, name, parentId FROM Category ORDER BY parentId, name;
```

## 已修复的问题

1. ✅ **API 返回格式优化**：现在返回格式化的分类数据，包含父分类信息
2. ✅ **前端加载状态**：添加了加载状态和错误处理
3. ✅ **空状态提示**：当没有分类时，显示友好的提示信息
4. ✅ **初始化脚本**：提供了快速创建默认分类的脚本

## 分类显示格式

分类在下拉列表中会显示为：
- **父分类**：`篮球鞋`
- **子分类**：`篮球鞋 > 高帮篮球鞋`

这样用户可以清楚地看到分类的层级关系。

## 后续添加新分类

如果需要添加新的分类，可以：

1. **使用 Prisma Studio**（推荐）：
   ```bash
   npx prisma studio
   ```

2. **修改初始化脚本**：在 `init-categories.js` 中添加新分类，然后重新运行

3. **直接操作数据库**：使用 SQL 插入新分类

## 常见问题

### Q: 运行脚本后仍然没有分类？

A: 检查：
1. 数据库连接是否正常（检查 `.env` 中的 `DATABASE_URL`）
2. 是否有权限错误
3. 查看脚本输出的错误信息

### Q: 分类显示为 "暂无分类，请联系管理员"？

A: 
1. 确认分类已创建（检查数据库或运行 `curl http://localhost:3000/api/categories`）
2. 刷新页面
3. 检查浏览器控制台是否有错误

### Q: 如何删除分类？

A: 使用 Prisma Studio 或直接操作数据库：
```sql
DELETE FROM Category WHERE id = 'category_id';
-- 注意：删除父分类前，需要先删除或移动其子分类
```

## 相关文件

- `init-categories.js` - 初始化分类脚本
- `app/api/categories/route.ts` - 分类 API 路由
- `app/products/new/page.tsx` - 添加商品页面
